{% extends "base.html" %}
{% block js %}
    {{ block.super }}
    <script>
        $(document).ready(function () {

            YUI().use(
                    "aui-scheduler",
                    function (Y) {
                        var events = [
                            {#                        {#}
                            {#                            content: "AllDay",#}
                            {#                            endDate: new Date(2013, 1, 5, 23, 59),#}
                            {#                            startDate: new Date(2013, 1, 5, 0)#}
                            {#                        },#}
                            {#                        {#}
                            {#                            color: "#8D8",#}
                            {#                            content: "Colorful",#}
                            {#                            endDate: new Date(2013, 1, 6, 6),#}
                            {#                            startDate: new Date(2013, 1, 6, 2)#}
                            {#                        },#}
                            {#                        {#}
                            {#                            content: "MultipleDays",#}
                            {#                            endDate: new Date(2013, 1, 8),#}
                            {#                            startDate: new Date(2013, 1, 4)#}
                            {#                        },#}
                            {#                        {#}
                            {#                            content: "Disabled",#}
                            {#                            disabled: true,#}
                            {#                            endDate: new Date(2013, 1, 8, 5),#}
                            {#                            startDate: new Date(2013, 1, 8, 1)#}
                            {#                        },#}
                            {#                        {#}
                            {#                            content: "Meeting",#}
                            {#                            endDate: new Date(2013, 1, 7, 7),#}
                            {#                            meeting: true,#}
                            {#                            startDate: new Date(2013, 1, 7, 3)#}
                            {#                        },#}
                            {#                        {#}
                            {#                            color: "#88D",#}
                            {#                            content: "Overlap",#}
                            {#                            endDate: new Date(2013, 1, 5, 4),#}
                            {#                            startDate: new Date(2013, 1, 5, 1)#}
                            {#                        },#}
                            {#                        {#}
                            {#                            content: "Reminder",#}
                            {#                            endDate: new Date(2013, 1, 4, 4),#}
                            {#                            reminder: true,#}
                            {#                            startDate: new Date(2013, 1, 4, 0)#}
                            {#                        }#}
                        ];

                        var agendaView = new Y.SchedulerAgendaView();
                        var dayView = new Y.SchedulerDayView();
                        var eventRecorder = new Y.SchedulerEventRecorder();
                        var monthView = new Y.SchedulerMonthView();
                        var weekView = new Y.SchedulerWeekView();

                        var scheduler = new Y.Scheduler({
                            activeView: monthView,
                            boundingBox: "#schedule",
                            eventRecorder: eventRecorder,
                            items: events,
                            render: true,
                            views: [dayView, weekView, monthView, agendaView]
                        });

                        var url = "{% url "pattern-list" %}";
                        var methodType = "GET";
                        $.ajax({
                            type: methodType,
                            url: url,
                            beforeSend: function () {
                                console.group("%s %s", methodType, url);
                            },
                            complete: function (jqXHR, textStatus) {
                                console.timeEnd(textStatus);
                                console.groupEnd();
                            },
                            success: function (data, textStatus, jqXHR) {
                                console.log(textStatus, data);
                                var events = [];
                                $.each(data, function (index, val) {
                                    console.log(index, val);
                                    var event = {
                                        content: val.participant.first_name + " " + val.participant.last_name + " " + val.action.description,
                                        idAttribute: "uuid",
                                        id: val.uuid,
                                        allDay: true,
                                        reminder: true,
                                        // Formats here: http://alloyui.com/api/classes/A.DateParser.html
                                        startDate: moment(val.date_occurrence).toDate()
                                    };
                                    events.push(event);
                                });
                                console.log("Adding the following events =>", events);
                                scheduler.addEvents(events);
                                scheduler.plotViewEvents(monthView);
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                console.log(textStatus, errorThrown);
                            }
                        });

                    }
            );
        });

    </script>
{% endblock js %}
{% block content %}
    <h1>Schedule <small class="title-details"></small></h1>
    <div>
        <div id="schedule"></div>
    </div>
{% endblock content %}
